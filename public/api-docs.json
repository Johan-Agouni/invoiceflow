{
  "openapi": "3.0.3",
  "info": {
    "title": "InvoiceFlow API",
    "description": "RESTful API for invoice and quote management. Perfect for integrating billing into your applications.\n\n## Authentication\nAll endpoints (except `/auth/token`) require a Bearer token.\n\n```\nAuthorization: Bearer your-api-token-here\n```\n\n## Rate Limiting\n100 requests per minute per token.\n\n## Errors\nAll errors return a consistent JSON structure:\n```json\n{\n  \"success\": false,\n  \"message\": \"Error description\",\n  \"errors\": { \"field\": [\"error\"] }\n}\n```",
    "version": "1.0.0",
    "contact": {
      "name": "Johan Agouni",
      "url": "https://github.com/Johan-Agouni"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080/api/v1",
      "description": "Development server"
    }
  ],
  "tags": [
    { "name": "Authentication", "description": "API token management" },
    { "name": "Clients", "description": "Client/Company management" },
    { "name": "Invoices", "description": "Invoice CRUD and actions" },
    { "name": "Quotes", "description": "Quote CRUD and actions" }
  ],
  "paths": {
    "/auth/token": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Generate API token",
        "description": "Authenticate with email/password to receive an API token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": { "type": "string", "format": "email", "example": "user@example.com" },
                  "password": { "type": "string", "example": "password123" },
                  "name": { "type": "string", "description": "Token name for identification", "example": "My App Token" },
                  "expires_at": { "type": "string", "format": "date-time", "description": "Optional expiration date" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": { "type": "string", "example": "abc123..." },
                        "token_type": { "type": "string", "example": "Bearer" },
                        "name": { "type": "string" },
                        "expires_at": { "type": "string", "nullable": true }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": ["Authentication"],
        "summary": "Get current user",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "User information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/tokens": {
      "get": {
        "tags": ["Authentication"],
        "summary": "List all API tokens",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "List of tokens" }
        }
      },
      "delete": {
        "tags": ["Authentication"],
        "summary": "Revoke all tokens",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "All tokens revoked" }
        }
      }
    },
    "/clients": {
      "get": {
        "tags": ["Clients"],
        "summary": "List all clients",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "search", "in": "query", "schema": { "type": "string" }, "description": "Search by company name or email" },
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "per_page", "in": "query", "schema": { "type": "integer", "default": 20, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "Paginated list of clients",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PaginatedClients" }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Clients"],
        "summary": "Create a client",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ClientInput" }
            }
          }
        },
        "responses": {
          "201": { "description": "Client created" },
          "422": { "$ref": "#/components/responses/ValidationError" }
        }
      }
    },
    "/clients/{id}": {
      "get": {
        "tags": ["Clients"],
        "summary": "Get a client",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Client details with stats" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "put": {
        "tags": ["Clients"],
        "summary": "Update a client",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ClientInput" }
            }
          }
        },
        "responses": {
          "200": { "description": "Client updated" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "delete": {
        "tags": ["Clients"],
        "summary": "Delete a client",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Client deleted" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "409": { "description": "Cannot delete client with invoices" }
        }
      }
    },
    "/invoices": {
      "get": {
        "tags": ["Invoices"],
        "summary": "List all invoices",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["draft", "pending", "paid", "overdue", "cancelled"] } },
          { "name": "client_id", "in": "query", "schema": { "type": "integer" } },
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "per_page", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": { "description": "Paginated list of invoices" }
        }
      },
      "post": {
        "tags": ["Invoices"],
        "summary": "Create an invoice",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/InvoiceInput" }
            }
          }
        },
        "responses": {
          "201": { "description": "Invoice created" },
          "422": { "$ref": "#/components/responses/ValidationError" }
        }
      }
    },
    "/invoices/stats": {
      "get": {
        "tags": ["Invoices"],
        "summary": "Get invoice statistics",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Statistics including totals and monthly revenue",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "data": {
                    "overview": { "total_invoices": 45, "draft": 3, "pending": 12, "paid": 28, "overdue": 2 },
                    "amounts": { "total_billed": 125000, "total_paid": 98000, "total_pending": 22000, "total_overdue": 5000 },
                    "monthly_revenue": [{ "month": "2024-01", "total": 12500 }]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/invoices/{id}": {
      "get": {
        "tags": ["Invoices"],
        "summary": "Get an invoice",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Invoice with items and client" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "put": {
        "tags": ["Invoices"],
        "summary": "Update an invoice",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Invoice updated" },
          "403": { "description": "Cannot modify paid invoice" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "delete": {
        "tags": ["Invoices"],
        "summary": "Delete an invoice",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Invoice deleted" },
          "403": { "description": "Cannot delete paid invoice" }
        }
      }
    },
    "/invoices/{id}/send": {
      "post": {
        "tags": ["Invoices"],
        "summary": "Send invoice (mark as pending)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Invoice sent" }
        }
      }
    },
    "/invoices/{id}/pay": {
      "post": {
        "tags": ["Invoices"],
        "summary": "Mark invoice as paid",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "paid_at": { "type": "string", "format": "date-time", "description": "Payment date (defaults to now)" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Invoice marked as paid" }
        }
      }
    },
    "/invoices/{id}/pdf": {
      "get": {
        "tags": ["Invoices"],
        "summary": "Download invoice PDF",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "PDF file",
            "content": { "application/pdf": {} }
          }
        }
      }
    },
    "/quotes": {
      "get": {
        "tags": ["Quotes"],
        "summary": "List all quotes",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["draft", "sent", "accepted", "declined", "expired", "invoiced"] } },
          { "name": "client_id", "in": "query", "schema": { "type": "integer" } },
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          { "name": "per_page", "in": "query", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Paginated list of quotes" }
        }
      },
      "post": {
        "tags": ["Quotes"],
        "summary": "Create a quote",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/QuoteInput" }
            }
          }
        },
        "responses": {
          "201": { "description": "Quote created" }
        }
      }
    },
    "/quotes/stats": {
      "get": {
        "tags": ["Quotes"],
        "summary": "Get quote statistics",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Statistics with conversion rate" }
        }
      }
    },
    "/quotes/{id}": {
      "get": {
        "tags": ["Quotes"],
        "summary": "Get a quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Quote with items" }
        }
      },
      "put": {
        "tags": ["Quotes"],
        "summary": "Update a quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Quote updated" },
          "403": { "description": "Cannot modify accepted/invoiced quote" }
        }
      },
      "delete": {
        "tags": ["Quotes"],
        "summary": "Delete a quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Quote deleted" }
        }
      }
    },
    "/quotes/{id}/send": {
      "post": {
        "tags": ["Quotes"],
        "summary": "Send quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Quote sent" } }
      }
    },
    "/quotes/{id}/accept": {
      "post": {
        "tags": ["Quotes"],
        "summary": "Accept quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Quote accepted" } }
      }
    },
    "/quotes/{id}/decline": {
      "post": {
        "tags": ["Quotes"],
        "summary": "Decline quote",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Quote declined" } }
      }
    },
    "/quotes/{id}/convert": {
      "post": {
        "tags": ["Quotes"],
        "summary": "Convert quote to invoice",
        "description": "Only accepted quotes can be converted",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "201": { "description": "Invoice created from quote" },
          "400": { "description": "Quote not accepted" }
        }
      }
    },
    "/quotes/{id}/pdf": {
      "get": {
        "tags": ["Quotes"],
        "summary": "Download quote PDF",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "content": { "application/pdf": {} } }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "API token obtained from /auth/token"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "Client": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "company_name": { "type": "string" },
          "contact_name": { "type": "string" },
          "email": { "type": "string" },
          "phone": { "type": "string" },
          "address": {
            "type": "object",
            "properties": {
              "street": { "type": "string" },
              "postal_code": { "type": "string" },
              "city": { "type": "string" },
              "country": { "type": "string" }
            }
          },
          "vat_number": { "type": "string" },
          "notes": { "type": "string" },
          "stats": {
            "type": "object",
            "properties": {
              "total_invoices": { "type": "integer" },
              "total_amount": { "type": "number" },
              "paid_amount": { "type": "number" },
              "pending_amount": { "type": "number" }
            }
          }
        }
      },
      "ClientInput": {
        "type": "object",
        "required": ["company_name"],
        "properties": {
          "company_name": { "type": "string", "minLength": 2, "maxLength": 255 },
          "contact_name": { "type": "string", "maxLength": 255 },
          "email": { "type": "string", "format": "email" },
          "phone": { "type": "string", "maxLength": 50 },
          "address": { "type": "string", "maxLength": 255 },
          "postal_code": { "type": "string", "maxLength": 20 },
          "city": { "type": "string", "maxLength": 100 },
          "country": { "type": "string", "maxLength": 100, "default": "France" },
          "vat_number": { "type": "string", "maxLength": 30 },
          "notes": { "type": "string" }
        }
      },
      "InvoiceInput": {
        "type": "object",
        "required": ["client_id", "issue_date", "due_date", "items"],
        "properties": {
          "client_id": { "type": "integer" },
          "issue_date": { "type": "string", "format": "date" },
          "due_date": { "type": "string", "format": "date" },
          "notes": { "type": "string" },
          "items": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/components/schemas/LineItem" }
          }
        }
      },
      "QuoteInput": {
        "type": "object",
        "required": ["client_id", "issue_date", "valid_until", "items"],
        "properties": {
          "client_id": { "type": "integer" },
          "issue_date": { "type": "string", "format": "date" },
          "valid_until": { "type": "string", "format": "date" },
          "notes": { "type": "string" },
          "items": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/components/schemas/LineItem" }
          }
        }
      },
      "LineItem": {
        "type": "object",
        "required": ["description", "quantity", "unit_price"],
        "properties": {
          "description": { "type": "string" },
          "quantity": { "type": "number", "minimum": 0.01 },
          "unit_price": { "type": "number", "minimum": 0 },
          "vat_rate": { "type": "number", "default": 20 }
        }
      },
      "PaginatedClients": {
        "type": "object",
        "properties": {
          "data": { "type": "array", "items": { "$ref": "#/components/schemas/Client" } },
          "meta": { "$ref": "#/components/schemas/PaginationMeta" }
        }
      },
      "PaginationMeta": {
        "type": "object",
        "properties": {
          "current_page": { "type": "integer" },
          "per_page": { "type": "integer" },
          "total": { "type": "integer" },
          "total_pages": { "type": "integer" },
          "has_more": { "type": "boolean" }
        }
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "Invalid or missing API token",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": { "type": "boolean", "example": false },
                "message": { "type": "string", "example": "Invalid or missing API token" }
              }
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": { "type": "boolean", "example": false },
                "message": { "type": "string", "example": "Resource not found" }
              }
            }
          }
        }
      },
      "ValidationError": {
        "description": "Validation failed",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": { "type": "boolean", "example": false },
                "message": { "type": "string", "example": "Validation failed" },
                "errors": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
